extends layout
block content
  .container
    h2 Hotline Numbers
    .success
    .error
    form(id='form1' action='/addNumber' method= 'post')
      input#id(type='hidden', name='id', value='')
      table
        tr
          td(style='text-align: center')
            input#country(type='text', name='country', placeholder='Country', value='')
            | &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            input#number(type='text', name='number', placeholder='Number', value='')
            | &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            input#subbtn.btn(type='submit', name='sub', value='Add Number')
    table.table
      tbody
        tr
          th Country
          th Key
          th Action
        if data.length
         each item in data
          tr(id='#{item["_id"]}')
            td#countryCell #{item['country']}
            td#numberCell #{item['number']}
            td
               a.editlink(href='javascript:void(0)', data-id='#{item["_id"]}', id='edit' + '#{item["_id"]}') Edit
               | &nbsp;&nbsp;
               a(href='/deleteNumber?id=#{item["_id"]}', onclick='return confirm("You are going to delete this number. Continue?")') Delete

    script(src='https://code.jquery.com/jquery-3.1.1.min.js')
    script.

      $(function() { 

        $('.editlink').on('click', function(){
          var id = $(this).data('id');
          var country = $('#' + id).find("td[id='countryCell']");
          country.attr('contentEditable', 'true');
          country.attr('style', 'border: 2px solid #000;');
          var number = $('#' + id).find("td[id='numberCell']");
          number.attr('contentEditable', 'true');
          number.attr('style', 'border: 2px solid #000;');
          $('#edit' + id).text('Confirm');
          $('#edit' + id).click(function() {
          
            $.ajax({

                method: "POST",

                url: "/editNumber",

                data: { id:  id, country: country.text(), number: number.text() },
                
                success: function(response) {
                            window.location = '/numbers';
                        }
            });
          });
        });
      });